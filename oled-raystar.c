/******************************************************************************
 * Copyright (C) 2016-2017 AEA s.r.l. Loccioni Group - Elctronic Design Dept.
 *
 * Authors:
 *  Simon Schuster <s.schuster@loccioni.com>
 *  Marco Giammarini <m.giammarini@loccioni.com>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 ******************************************************************************/

#include "oled-raystar.h"

#define OLEDRAYSTAR_CMD_SET_COLUMN_ADDR     0x15
#define OLEDRAYSTAR_CMD_SET_ROW_ADDR        0x75
#define OLEDRAYSTAR_CMD_SET_COTRAST         0x81
#define OLEDRAYSTAR_CMD_SET_REMAP           0xA0
#define OLEDRAYSTAR_CMD_SET_START_LINE      0xA1
#define OLEDRAYSTAR_CMD_SET_OFFSET          0xA2
#define OLEDRAYSTAR_CMD_MODE_NORMAL         0xA4
#define OLEDRAYSTAR_CMD_MODE_SET_ENTIRE_ON  0xA5
#define OLEDRAYSTAR_CMD_MODE_SET_ENTIRE_OFF 0xA6
#define OLEDRAYSTAR_CMD_MODE_INVERSE        0xA7
#define OLEDRAYSTAR_CMD_SET_MULTPLEX_RATIO  0xA8
#define OLEDRAYSTAR_CMD_SET_MASTER_CONFIG   0xAD
#define OLEDRAYSTAR_CMD_SET_OFF             0xAE
#define OLEDRAYSTAR_CMD_SET_ON              0xAF
#define OLEDRAYSTAR_CMD_SET_VCOMH           0xBE
#define OLEDRAYSTAR_CMD_SET_PRECHARGE_VOLT  0xBC
#define OLEDRAYSTAR_CMD_SET_PHASE_LENGTH    0xB1
#define OLEDRAYSTAR_CMD_SET_ROW_PERIOD      0xB2
#define OLEDRAYSTAR_CMD_SET_CLOCK_DIVIDE    0xB3
#define OLEDRAYSTAR_CMD_NOP                 0xE3

#define OLEDRAYSTAR_REMAP_COLUMN            0x01
#define OLEDRAYSTAR_REMAP_NIBBLE            0x02
#define OLEDRAYSTAR_REMAP_ADDR_INCREMENT    0x04
#define OLEDRAYSTAR_REMAP_COM               0x10
#define OLEDRAYSTAR_REMAP_ODDEVEN_COM       0x40

/** Generic font */
const char OledRaystar_basicFont[256][6]=
{
    {0x00,0x00,0x00,0x00,0x00,0x00},    // 0x00
    {0x00,0x7C,0xA2,0x8A,0xA2,0x7C},    // 0x01
    {0x00,0x7C,0xD6,0xF6,0xD6,0x7C},    // 0x02
    {0x00,0x38,0x7C,0x3E,0x7C,0x38},    // 0x03
    {0x00,0x18,0x3C,0x7E,0x3C,0x18},    // 0x04
    {0x00,0x0C,0x6C,0xFE,0x6C,0x0C},    // 0x05
    {0x00,0x18,0x3A,0x7E,0x3A,0x18},    // 0x06
    {0x00,0x00,0x00,0x00,0x00,0x00},    // 0x07
    {0x00,0x00,0x00,0x00,0x00,0x00},    // 0x08
    {0x00,0x00,0x00,0x00,0x00,0x00},    // 0x09
    {0x00,0x00,0x00,0x00,0x00,0x00},    // 0x0A
    {0x00,0x0C,0x12,0x52,0x6C,0x70},    // 0x0B
    {0x00,0x60,0x94,0x9E,0x94,0x60},    // 0x0C
    {0x00,0x00,0x00,0x00,0x00,0x00},    // 0x0D
    {0x00,0x06,0x7E,0x50,0xAC,0xFC},    // 0x0E
    {0x00,0x54,0x38,0x6C,0x38,0x54},    // 0x0F
    {0x00,0x00,0xFE,0x7C,0x38,0x10},    // 0x10
    {0x00,0x10,0x38,0x7C,0xFE,0x00},    // 0x11
    {0x00,0x28,0x6C,0xFE,0x6C,0x28},    // 0x12
    {0x00,0x00,0xFA,0x00,0xFA,0x00},    // 0x13
    {0x00,0x60,0x90,0xFE,0x80,0xFE},    // 0x14
    {0x00,0x44,0xB2,0xAA,0x9A,0x44},    // 0x15
    {0x00,0x06,0x06,0x06,0x06,0x00},    // 0x16
    {0x00,0x28,0x6D,0xFF,0x6D,0x28},    // 0x17
    {0x00,0x20,0x60,0xFE,0x60,0x20},    // 0x18
    {0x00,0x08,0x0C,0xFE,0x0C,0x08},    // 0x19
    {0x00,0x10,0x10,0x7C,0x38,0x10},    // 0x1A
    {0x00,0x10,0x38,0x7C,0x10,0x10},    // 0x1B
    {0x00,0x1E,0x02,0x02,0x02,0x02},    // 0x1C
    {0x00,0x10,0x7C,0x10,0x7C,0x10},    // 0x1D
    {0x00,0x0C,0x3C,0xFC,0x3C,0x0C},    // 0x1E
    {0x00,0xC0,0xF0,0xFC,0xF0,0xC0},    // 0x1F
    {0x00,0x00,0x00,0x00,0x00,0x00},    // 0x20
    {0x00,0x00,0x60,0xFA,0x60,0x00},    // 0x21
    {0x00,0xE0,0xC0,0x00,0xE0,0xC0},    // 0x22
    {0x00,0x24,0x7E,0x24,0x7E,0x24},    // 0x23
    {0x00,0x24,0xD4,0x56,0x48,0x00},    // 0x24
    {0x00,0xC6,0xC8,0x10,0x26,0xC6},    // 0x25
    {0x00,0x6C,0x92,0x6A,0x04,0x0A},    // 0x26
    {0x00,0x00,0xE0,0xC0,0x00,0x00},    // 0x27
    {0x00,0x00,0x7C,0x82,0x00,0x00},    // 0x28
    {0x00,0x00,0x82,0x7C,0x00,0x00},    // 0x29
    {0x00,0x10,0x7C,0x38,0x7C,0x10},    // 0x2A
    {0x00,0x10,0x10,0x7C,0x10,0x10},    // 0x2B
    {0x00,0x00,0x07,0x06,0x00,0x00},    // 0x2C
    {0x00,0x10,0x10,0x10,0x10,0x10},    // 0x2D
    {0x00,0x00,0x06,0x06,0x00,0x00},    // 0x2E
    {0x00,0x04,0x08,0x10,0x20,0x40},    // 0x2F
    {0x00,0x7C,0x8A,0x92,0xA2,0x7C},    // 0x30
    {0x00,0x00,0x42,0xFE,0x02,0x00},    // 0x31
    {0x00,0x46,0x8A,0x92,0x92,0x62},    // 0x32
    {0x00,0x44,0x92,0x92,0x92,0x6C},    // 0x33
    {0x00,0x18,0x28,0x48,0xFE,0x08},    // 0x34
    {0x00,0xF4,0x92,0x92,0x92,0x8C},    // 0x35
    {0x00,0x3C,0x52,0x92,0x92,0x0C},    // 0x36
    {0x00,0x80,0x8E,0x90,0xA0,0xC0},    // 0x37
    {0x00,0x6C,0x92,0x92,0x92,0x6C},    // 0x38
    {0x00,0x60,0x92,0x92,0x94,0x78},    // 0x39
    {0x00,0x00,0x36,0x36,0x00,0x00},    // 0x3A
    {0x00,0x00,0x37,0x36,0x00,0x00},    // 0x3B
    {0x00,0x10,0x28,0x44,0x82,0x00},    // 0x3C
    {0x00,0x24,0x24,0x24,0x24,0x24},    // 0x3D
    {0x00,0x00,0x82,0x44,0x28,0x10},    // 0x3E
    {0x00,0x40,0x80,0x9A,0x90,0x60},    // 0x3F
    {0x00,0x7C,0x82,0xBA,0xAA,0x78},    // 0x40
    {0x00,0x7E,0x88,0x88,0x88,0x7E},    // 0x41
    {0x00,0xFE,0x92,0x92,0x92,0x6C},    // 0x42
    {0x00,0x7C,0x82,0x82,0x82,0x44},    // 0x43
    {0x00,0xFE,0x82,0x82,0x82,0x7C},    // 0x44
    {0x00,0xFE,0x92,0x92,0x92,0x82},    // 0x45
    {0x00,0xFE,0x90,0x90,0x90,0x80},    // 0x46
    {0x00,0x7C,0x82,0x92,0x92,0x5E},    // 0x47
    {0x00,0xFE,0x10,0x10,0x10,0xFE},    // 0x48
    {0x00,0x00,0x82,0xFE,0x82,0x00},    // 0x49
    {0x00,0x0C,0x02,0x02,0x02,0xFC},    // 0x4A
    {0x00,0xFE,0x10,0x28,0x44,0x82},    // 0x4B
    {0x00,0xFE,0x02,0x02,0x02,0x02},    // 0x4C
    {0x00,0xFE,0x40,0x20,0x40,0xFE},    // 0x4D
    {0x00,0xFE,0x40,0x20,0x10,0xFE},    // 0x4E
    {0x00,0x7C,0x82,0x82,0x82,0x7C},    // 0x4F
    {0x00,0xFE,0x90,0x90,0x90,0x60},    // 0x50
    {0x00,0x7C,0x82,0x8A,0x84,0x7A},    // 0x51
    {0x00,0xFE,0x90,0x90,0x98,0x66},    // 0x52
    {0x00,0x64,0x92,0x92,0x92,0x4C},    // 0x53
    {0x00,0x80,0x80,0xFE,0x80,0x80},    // 0x54
    {0x00,0xFC,0x02,0x02,0x02,0xFC},    // 0x55
    {0x00,0xF8,0x04,0x02,0x04,0xF8},    // 0x56
    {0x00,0xFC,0x02,0x3C,0x02,0xFC},    // 0x57
    {0x00,0xC6,0x28,0x10,0x28,0xC6},    // 0x58
    {0x00,0xE0,0x10,0x0E,0x10,0xE0},    // 0x59
    {0x00,0x8E,0x92,0xA2,0xC2,0x00},    // 0x5A
    {0x00,0x00,0xFE,0x82,0x82,0x00},    // 0x5B
    {0x00,0x40,0x20,0x10,0x08,0x04},    // 0x5C
    {0x00,0x00,0x82,0x82,0xFE,0x00},    // 0x5D
    {0x00,0x20,0x40,0x80,0x40,0x20},    // 0x5E
    {0x01,0x01,0x01,0x01,0x01,0x01},    // 0x5F
    {0x00,0x00,0xC0,0xE0,0x00,0x00},    // 0x60
    {0x00,0x04,0x2A,0x2A,0x2A,0x1E},    // 0x61
    {0x00,0xFE,0x22,0x22,0x22,0x1C},    // 0x62
    {0x00,0x1C,0x22,0x22,0x22,0x14},    // 0x63
    {0x00,0x1C,0x22,0x22,0x22,0xFE},    // 0x64
    {0x00,0x1C,0x2A,0x2A,0x2A,0x10},    // 0x65
    {0x00,0x10,0x7E,0x90,0x90,0x00},    // 0x66
    {0x00,0x18,0x25,0x25,0x25,0x3E},    // 0x67
    {0x00,0xFE,0x20,0x20,0x1E,0x00},    // 0x68
    {0x00,0x00,0x00,0xBE,0x02,0x00},    // 0x69
    {0x00,0x02,0x01,0x21,0xBE,0x00},    // 0x6A
    {0x00,0xFE,0x08,0x14,0x22,0x00},    // 0x6B
    {0x00,0x00,0x00,0xFE,0x02,0x00},    // 0x6C
    {0x00,0x3E,0x20,0x18,0x20,0x1E},    // 0x6D
    {0x00,0x3E,0x20,0x20,0x1E,0x00},    // 0x6E
    {0x00,0x1C,0x22,0x22,0x22,0x1C},    // 0x6F
    {0x00,0x3F,0x22,0x22,0x22,0x1C},    // 0x70
    {0x00,0x1C,0x22,0x22,0x22,0x3F},    // 0x71
    {0x00,0x22,0x1E,0x22,0x20,0x10},    // 0x72
    {0x00,0x10,0x2A,0x2A,0x2A,0x04},    // 0x73
    {0x00,0x20,0x7C,0x22,0x24,0x00},    // 0x74
    {0x00,0x3C,0x02,0x04,0x3E,0x00},    // 0x75
    {0x00,0x38,0x04,0x02,0x04,0x38},    // 0x76
    {0x00,0x3C,0x06,0x0C,0x06,0x3C},    // 0x77
    {0x00,0x36,0x08,0x08,0x36,0x00},    // 0x78
    {0x00,0x39,0x05,0x06,0x3C,0x00},    // 0x79
    {0x00,0x26,0x2A,0x2A,0x32,0x00},    // 0x7A
    {0x00,0x10,0x7C,0x82,0x82,0x00},    // 0x7B
    {0x00,0x00,0x00,0xEE,0x00,0x00},    // 0x7C
    {0x00,0x00,0x82,0x82,0x7C,0x10},    // 0x7D
    {0x00,0x40,0x80,0x40,0x80,0x00},    // 0x7E
    {0x00,0x3C,0x64,0xC4,0x64,0x3C},    // 0x7F
    {0x00,0x78,0x85,0x87,0x84,0x48},    // 0x80
    {0x00,0xBC,0x02,0x04,0xBE,0x00},    // 0x81
    {0x00,0x1C,0x2A,0x2A,0xAA,0x90},    // 0x82
    {0x00,0x04,0xAA,0xAA,0xAA,0x1E},    // 0x83
    {0x00,0x04,0xAA,0x2A,0xAA,0x1E},    // 0x84
    {0x00,0x04,0xAA,0xAA,0x2A,0x1E},    // 0x85
    {0x00,0x04,0xEA,0xAA,0xEA,0x1E},    // 0x86
    {0x00,0x38,0x45,0x47,0x44,0x28},    // 0x87
    {0x00,0x1C,0xAA,0xAA,0xAA,0x10},    // 0x88
    {0x00,0x1C,0xAA,0x2A,0xAA,0x10},    // 0x89
    {0x00,0x1C,0xAA,0xAA,0x2A,0x10},    // 0x8A
    {0x00,0x00,0x80,0x3E,0x82,0x00},    // 0x8B
    {0x00,0x00,0x80,0xBE,0x82,0x00},    // 0x8C
    {0x00,0x00,0x80,0x3E,0x02,0x00},    // 0x8D
    {0x00,0x0E,0x94,0x24,0x94,0x0E},    // 0x8E
    {0x00,0x1E,0xF4,0xA4,0xF4,0x1E},    // 0x8F
    {0x00,0x3E,0x2A,0x2A,0xAA,0xA2},    // 0x90
    {0x00,0x2C,0x2A,0x3E,0x2A,0x1A},    // 0x91
    {0x00,0x7E,0x90,0xFE,0x92,0x92},    // 0x92
    {0x00,0x1C,0xA2,0xA2,0x9C,0x00},    // 0x93
    {0x00,0x1C,0xA2,0x22,0x9C,0x00},    // 0x94
    {0x00,0x9C,0xA2,0x22,0x1C,0x00},    // 0x95
    {0x00,0x3C,0x82,0x84,0xBE,0x00},    // 0x96
    {0x00,0xBC,0x82,0x04,0x3E,0x00},    // 0x97
    {0x00,0x39,0x85,0x06,0xBC,0x00},    // 0x98
    {0x00,0xBC,0x42,0x42,0xBC,0x00},    // 0x99
    {0x00,0x3C,0x82,0x02,0xBC,0x00},    // 0x9A
    {0x01,0x0E,0x16,0x1A,0x1C,0x20},    // 0x9B
    {0x00,0x12,0x7C,0x92,0x92,0x46},    // 0x9C
    {0x00,0x7E,0x86,0xBA,0xC2,0xFC},    // 0x9D
    {0x00,0x44,0x28,0x10,0x28,0x44},    // 0x9E
    {0x00,0x02,0x11,0x7E,0x90,0x40},    // 0x9F
    {0x00,0x04,0x2A,0xAA,0xAA,0x1E},    // 0xA0
    {0x00,0x00,0x00,0xBE,0x82,0x00},    // 0xA1
    {0x00,0x1C,0x22,0xA2,0x9C,0x00},    // 0xA2
    {0x00,0x3C,0x02,0x84,0xBE,0x00},    // 0xA3
    {0x00,0x5E,0x90,0x50,0x8E,0x00},    // 0xA4
    {0x00,0x5E,0x88,0x44,0x9E,0x00},    // 0xA5
    {0x00,0x10,0xAA,0xAA,0xAA,0x7A},    // 0xA6
    {0x00,0x72,0x8A,0x8A,0x72,0x00},    // 0xA7
    {0x00,0x0C,0x12,0xB2,0x02,0x04},    // 0xA8
    {0x7C,0x82,0xBA,0xD2,0xAA,0x7C},    // 0xA9
    {0x20,0x20,0x20,0x20,0x20,0x38},    // 0xAA
    {0x00,0xE8,0x10,0x32,0x56,0x0A},    // 0xAB
    {0x00,0xE8,0x10,0x2C,0x54,0x1E},    // 0xAC
    {0x00,0x00,0x0C,0xBE,0x0C,0x00},    // 0xAD
    {0x00,0x10,0x28,0x00,0x10,0x28},    // 0xAE
    {0x00,0x28,0x10,0x00,0x28,0x10},    // 0xAF
    {0x22,0x88,0x22,0x88,0x22,0x88},    // 0xB0
    {0x55,0xAA,0x55,0xAA,0x55,0xAA},    // 0xB1
    {0xDD,0x77,0xDD,0x77,0xDD,0x77},    // 0xB2
    {0x00,0x00,0x00,0xFF,0x00,0x00},    // 0xB3
    {0x10,0x10,0x10,0xFF,0x00,0x00},    // 0xB4
    {0x00,0x0E,0x14,0xA4,0x94,0x0E},    // 0xB5
    {0x00,0x0E,0x94,0xA4,0x94,0x0E},    // 0xB6
    {0x00,0x0E,0x94,0xA4,0x14,0x0E},    // 0xB7
    {0x7C,0x82,0xBA,0xAA,0x82,0x7C},    // 0xB8
    {0x50,0xDF,0x00,0xFF,0x00,0x00},    // 0xB9
    {0x00,0xFF,0x00,0xFF,0x00,0x00},    // 0xBA
    {0x50,0x5F,0x40,0x7F,0x00,0x00},    // 0xBB
    {0x50,0xD0,0x10,0xF0,0x00,0x00},    // 0xBC
    {0x00,0x18,0x24,0x66,0x24,0x00},    // 0xBD
    {0x00,0x94,0x54,0x3E,0x54,0x94},    // 0xBE
    {0x10,0x10,0x10,0x1F,0x00,0x00},    // 0xBF
    {0x00,0x00,0x00,0xF0,0x10,0x10},    // 0xC0
    {0x10,0x10,0x10,0xF0,0x10,0x10},    // 0xC1
    {0x10,0x10,0x10,0x1F,0x10,0x10},    // 0xC2
    {0x00,0x00,0x00,0xFF,0x10,0x10},    // 0xC3
    {0x10,0x10,0x10,0x10,0x10,0x10},    // 0xC4
    {0x10,0x10,0x10,0xFF,0x10,0x10},    // 0xC5
    {0x00,0x04,0x6A,0xAA,0x6A,0x9E},    // 0xC6
    {0x00,0x0E,0x54,0xA4,0x54,0x8E},    // 0xC7
    {0x00,0xF0,0x10,0xD0,0x50,0x50},    // 0xC8
    {0x00,0x7F,0x40,0x5F,0x50,0x50},    // 0xC9
    {0x50,0xD0,0x10,0xD0,0x50,0x50},    // 0xCA
    {0x50,0x5F,0x40,0x5F,0x50,0x50},    // 0xCB
    {0x00,0xFF,0x00,0xDF,0x50,0x50},    // 0xCC
    {0x50,0x50,0x50,0x50,0x50,0x50},    // 0xCD
    {0x50,0xDF,0x00,0xDF,0x50,0x50},    // 0xCE
    {0x00,0xBA,0x44,0x44,0x44,0xBA},    // 0xCF
    {0x00,0x44,0xAA,0x9A,0x0C,0x00},    // 0xD0
    {0x00,0x10,0xFE,0x92,0x82,0x7C},    // 0xD1
    {0x00,0x3E,0xAA,0xAA,0xAA,0x22},    // 0xD2
    {0x00,0x3E,0xAA,0x2A,0xAA,0x22},    // 0xD3
    {0x00,0x3E,0xAA,0xAA,0x2A,0x22},    // 0xD4
    {0x00,0x00,0x00,0xE0,0x00,0x00},    // 0xD5
    {0x00,0x00,0x22,0xBE,0xA2,0x00},    // 0xD6
    {0x00,0x00,0xA2,0xBE,0xA2,0x00},    // 0xD7
    {0x00,0x00,0xA2,0x3E,0xA2,0x00},    // 0xD8
    {0x10,0x10,0x10,0xF0,0x00,0x00},    // 0xD9
    {0x00,0x00,0x00,0x1F,0x10,0x10},    // 0xDA
    {0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},    // 0xDB
    {0x0F,0x0F,0x0F,0x0F,0x0F,0x0F},    // 0xDC
    {0x00,0x00,0x00,0xEE,0x00,0x00},    // 0xDD
    {0x00,0x00,0xA2,0xBE,0x22,0x00},    // 0xDE
    {0xF0,0xF0,0xF0,0xF0,0xF0,0xF0},    // 0xDF
    {0x00,0x3C,0x42,0xC2,0xBC,0x00},    // 0xE0
    {0x00,0x7F,0x52,0x52,0x2C,0x00},    // 0xE1
    {0x00,0x3C,0xC2,0xC2,0xBC,0x00},    // 0xE2
    {0x00,0xBC,0xC2,0x42,0x3C,0x00},    // 0xE3
    {0x00,0x04,0xAA,0x2A,0xAA,0x1E},    // 0xE4
    {0x00,0x5C,0xA2,0x62,0x9C,0x00},    // 0xE5
    {0x00,0x3F,0x04,0x04,0x38,0x00},    // 0xE6
    {0x00,0x7F,0x55,0x14,0x08,0x00},    // 0xE7
    {0x00,0xFF,0xA5,0x24,0x18,0x00},    // 0xE8
    {0x00,0x3C,0x02,0x82,0xBC,0x00},    // 0xE9
    {0x00,0x3C,0x82,0x82,0xBC,0x00},    // 0xEA
    {0x00,0xBC,0x82,0x02,0x3C,0x00},    // 0xEB
    {0x00,0x39,0x05,0x86,0xBC,0x00},    // 0xEC
    {0x00,0x20,0x10,0x8E,0x90,0x20},    // 0xED
    {0x00,0x00,0x40,0x40,0x40,0x00},    // 0xEE
    {0x00,0x00,0xE0,0xC0,0x00,0x00},    // 0xEF
    {0x00,0x00,0x10,0x10,0x10,0x00},    // 0xF0
    {0x00,0x00,0x24,0x74,0x24,0x00},    // 0xF1
    {0x00,0x24,0x24,0x24,0x24,0x24},    // 0xF2
    {0xA0,0xE8,0x50,0x2C,0x54,0x1E},    // 0xF3
    {0x00,0x60,0x90,0xFE,0x80,0xFE},    // 0xF4
    {0x00,0x44,0xB2,0xAA,0x9A,0x44},    // 0xF5
    {0x00,0x10,0x10,0x54,0x10,0x10},    // 0xF6
    {0x00,0x00,0x10,0x18,0x18,0x00},    // 0xF7
    {0x00,0x60,0x90,0x90,0x60,0x00},    // 0xF8
    {0x00,0x00,0x10,0x00,0x10,0x00},    // 0xF9
    {0x00,0x00,0x10,0x00,0x00,0x00},    // 0xFA
    {0x00,0x40,0xF0,0x00,0x00,0x00},    // 0xFB
    {0x00,0x90,0xF0,0xA0,0x00,0x00},    // 0xFC
    {0x00,0x90,0xB0,0x50,0x00,0x00},    // 0xFD
    {0x00,0x3C,0x3C,0x3C,0x3C,0x00},    // 0xFE
    {0x00,0x00,0x00,0x00,0x00,0x00}     // 0xFF
};

/**
 * The function write all bit of the command to the physical pin. 4 bit version.
 *
 * @param[in] dev The handle of the device
 * @param[in] value The data to be written
 */
static void OledRaystar_write4 (OledRaystar_Device* dev, uint8_t value)
{
    ((value & 0x01) > 0) ? Gpio_set(dev->d0) : Gpio_clear(dev->d0);
    ((value & 0x02) > 0) ? Gpio_set(dev->d1) : Gpio_clear(dev->d1);
    ((value & 0x04) > 0) ? Gpio_set(dev->d2) : Gpio_clear(dev->d2);
    ((value & 0x08) > 0) ? Gpio_set(dev->d3) : Gpio_clear(dev->d3);
}

/**
 * The function write all bit of the command to the physical pin. 8 bit version.
 *
 * @param[in] dev The handle of the device
 * @param[in] value The data to be written
 */
static void OledRaystar_write8 (OledRaystar_Device* dev, uint8_t value)
{
    ((value & 0x01) > 0) ? Gpio_set(dev->d0) : Gpio_clear(dev->d0);
    ((value & 0x02) > 0) ? Gpio_set(dev->d1) : Gpio_clear(dev->d1);
    ((value & 0x04) > 0) ? Gpio_set(dev->d2) : Gpio_clear(dev->d2);
    ((value & 0x08) > 0) ? Gpio_set(dev->d3) : Gpio_clear(dev->d3);
    ((value & 0x10) > 0) ? Gpio_set(dev->d4) : Gpio_clear(dev->d4);
    ((value & 0x20) > 0) ? Gpio_set(dev->d5) : Gpio_clear(dev->d5);
    ((value & 0x40) > 0) ? Gpio_set(dev->d6) : Gpio_clear(dev->d6);
    ((value & 0x80) > 0) ? Gpio_set(dev->d7) : Gpio_clear(dev->d7);
}

/**
 * The function send a command byte to the display.
 *
 * @param[in] dev The handle of the device
 * @param[in] value The data to be written
 * @param[in] isWrite This bool must be true for writing operation
 * @return The read value when isWrite is FALSE, 0 otherwise
 */
static uint8_t OledRaystar_sendCommand (OledRaystar_Device* dev,
                                        uint8_t value,
                                        bool isWrite)
{
    // See pag. 17 of SSD1325.pdf
    if (isWrite)
    {
        Gpio_set(dev->rd);
        Gpio_clear(dev->cs);
        Gpio_set(dev->wr);
        // Is command message
        Gpio_clear(dev->dc);
        // Enable writing
        Gpio_clear(dev->wr);
        OledRaystar_write8(dev,value);
        // Restore write pin
        Gpio_set(dev->wr);
        // Disable device
        Gpio_set(dev->cs);
        return 0;
    }
}

/**
 * The function send a data byte to the display.
 *
 * @param[in] dev The handle of the device
 * @param[in] value The data to be written
 * @param[in] isWrite This bool must be true for writing operation
 * @return The read value when isWrite is FALSE, 0 otherwise
 */
static uint8_t OledRaystar_sendData (OledRaystar_Device* dev,
                                     uint8_t value,
                                     bool isWrite)
{
    // See pag. 17 of SSD1325.pdf
    if (isWrite)
    {
        Gpio_set(dev->rd);
        Gpio_clear(dev->cs);
        Gpio_set(dev->wr);
        // is data message
        Gpio_set(dev->dc);
        // Enable writing
        Gpio_clear(dev->wr);
        OledRaystar_write8(dev,value);
        // Restore write pin
        Gpio_set(dev->wr);
        // Disable device
        Gpio_set(dev->cs);
        return 0;
    }
}

/**
 * The function set the current position into the display. The values are related to
 * the internal buffer and not to the pixel of the display.
 *
 * @param[in] dev The handle of the device
 * @param[in] xPosition The x position into the buffer
 * @param[in] yPosition The y position into the buffer
 * @return Return an error if the requested position is wrong,
 *         OLEDRAYSTAR_ERRORS_OK otherwise.
 */
static OledRaystar_Errors OledRaystar_setBufferPosition (OledRaystar_Device* dev,
                                                         uint8_t xPosition,
                                                         uint8_t yPosition)
{
    if ((xPosition > 63) || (yPosition > 63)) return OLEDRAYSTAR_ERRORS_WRONG_POSITION;

    // Save current position
    dev->xPosition = xPosition;
    dev->yPosition = yPosition;

    // Set column address
    OledRaystar_sendCommand(dev,OLEDRAYSTAR_CMD_SET_COLUMN_ADDR,TRUE);
    OledRaystar_sendCommand(dev,xPosition,TRUE);
    OledRaystar_sendCommand(dev,0x3F,TRUE); // Max value!

    // Set row address
    OledRaystar_sendCommand(dev,OLEDRAYSTAR_CMD_SET_ROW_ADDR,TRUE);
    OledRaystar_sendCommand(dev,yPosition,TRUE);
    OledRaystar_sendCommand(dev,0x3F,TRUE); // Max value!

    return OLEDRAYSTAR_ERRORS_OK;
}

void OledRaystar_init (OledRaystar_Device* dev)
{
    Gpio_config(dev->d0,GPIO_PINS_OUTPUT);
    Gpio_config(dev->d1,GPIO_PINS_OUTPUT);
    Gpio_config(dev->d2,GPIO_PINS_OUTPUT);
    Gpio_config(dev->d3,GPIO_PINS_OUTPUT);
    Gpio_config(dev->d4,GPIO_PINS_OUTPUT);
    Gpio_config(dev->d5,GPIO_PINS_OUTPUT);
    Gpio_config(dev->d6,GPIO_PINS_OUTPUT);
    Gpio_config(dev->d7,GPIO_PINS_OUTPUT);

    Gpio_config(dev->rd,GPIO_PINS_OUTPUT);
    Gpio_config(dev->dc,GPIO_PINS_OUTPUT);
    Gpio_config(dev->rs,GPIO_PINS_OUTPUT);
    Gpio_config(dev->cs,GPIO_PINS_OUTPUT);
    Gpio_config(dev->wr,GPIO_PINS_OUTPUT);

    Gpio_set(dev->dc);
    Gpio_set(dev->rd);
    Gpio_set(dev->wr);
    Gpio_set(dev->cs);
    Gpio_set(dev->rs);

    // Reset sequence
    OledRaystar_sendCommand(dev,OLEDRAYSTAR_CMD_SET_ON,TRUE);
    // Wait 100ms after on
    dev->delayTime(1000);
    // Set remap, it's fix for every type of display!
    switch (dev->model)
    {
    case OLEDRAYSTAR_MODEL_REX012864F:
        // REX012864F: enable nibble-remap and COM split odd/even
        OledRaystar_sendCommand(dev,OLEDRAYSTAR_CMD_SET_REMAP,TRUE);
        // FIXME: For vertical use: ADDR_INCREMENT is for vertical increment, and COLUMN is for revert column address
        uint8_t vertical = (dev->isVertical) ? OLEDRAYSTAR_REMAP_ADDR_INCREMENT | OLEDRAYSTAR_REMAP_COLUMN : 0;
        OledRaystar_sendCommand(dev,
                                OLEDRAYSTAR_REMAP_NIBBLE | OLEDRAYSTAR_REMAP_ODDEVEN_COM | vertical,
                                TRUE);
        // Set columns and rows number
        dev->columns = 128;
        dev->rows = 64;
        // Set starting position
        dev->xPosition = 0;
        dev->yPosition = 0;
        break;
    }

    // init dump array
    for (uint8_t i = 0; i < 64; ++i)
    {
        for (uint8_t j = 0; j < 64; ++j)
        {
            dev->dump[i][j] = 0;
            dev->dumpOld[i][j] = 0;
        }
    }
}

OledRaystar_Errors OledRaystar_setContrast (OledRaystar_Device* dev, uint8_t value)
{
    if (value > 0x7F) return OLEDRAYSTAR_ERRORS_WRONG_VALUE;

    // Set column address
    OledRaystar_sendCommand(dev,OLEDRAYSTAR_CMD_SET_COTRAST,TRUE);
    OledRaystar_sendCommand(dev,value,TRUE);

    return OLEDRAYSTAR_ERRORS_OK;
}

void OledRaystar_setDisplayOn (OledRaystar_Device* dev)
{
    OledRaystar_sendCommand(dev,OLEDRAYSTAR_CMD_SET_ON,TRUE);
}

void OledRaystar_setDisplayOff (OledRaystar_Device* dev)
{
    OledRaystar_sendCommand(dev,OLEDRAYSTAR_CMD_SET_OFF,TRUE);
}

OledRaystar_Errors OledRaystar_setPixel (OledRaystar_Device* dev,
                                         uint8_t xPosition,
                                         uint8_t yPosition,
                                         OledRaystar_GrayScale grayscale)
{
    if (grayscale > 0x0F) return OLEDRAYSTAR_ERRORS_WRONG_VALUE;

    if (xPosition%2)
    {
        dev->dump[xPosition>>1][yPosition] = ((grayscale & 0x0F) | (dev->dump[xPosition>>1][yPosition] & 0xF0));
    }
    else
    {
        dev->dump[xPosition>>1][yPosition] = (((grayscale << 4) & 0xF0) | (dev->dump[xPosition>>1][yPosition] & 0x0F));
    }

    return OLEDRAYSTAR_ERRORS_OK;
}


void OledRaystar_putChar (OledRaystar_Device* dev,
                          uint8_t c,
                          uint8_t xPosition,
                          uint8_t yPosition,
                          OledRaystar_GrayScale grayscale)
{
    uint8_t i = 0;

    for (i=0; i<6; i++)
    {
        ((OledRaystar_basicFont[c][i] & 0x80) > 0) ? (OledRaystar_setPixel(dev,xPosition + i,yPosition + 0,grayscale)) : (0);
        ((OledRaystar_basicFont[c][i] & 0x40) > 0) ? (OledRaystar_setPixel(dev,xPosition + i,yPosition + 1,grayscale)) : (0);
        ((OledRaystar_basicFont[c][i] & 0x20) > 0) ? (OledRaystar_setPixel(dev,xPosition + i,yPosition + 2,grayscale)) : (0);
        ((OledRaystar_basicFont[c][i] & 0x10) > 0) ? (OledRaystar_setPixel(dev,xPosition + i,yPosition + 3,grayscale)) : (0);
        ((OledRaystar_basicFont[c][i] & 0x08) > 0) ? (OledRaystar_setPixel(dev,xPosition + i,yPosition + 4,grayscale)) : (0);
        ((OledRaystar_basicFont[c][i] & 0x04) > 0) ? (OledRaystar_setPixel(dev,xPosition + i,yPosition + 5,grayscale)) : (0);
        ((OledRaystar_basicFont[c][i] & 0x02) > 0) ? (OledRaystar_setPixel(dev,xPosition + i,yPosition + 6,grayscale)) : (0);
        ((OledRaystar_basicFont[c][i] & 0x01) > 0) ? (OledRaystar_setPixel(dev,xPosition + i,yPosition + 7,grayscale)) : (0);
    }
}

void OledRaystar_putString (OledRaystar_Device* dev,
                            uint8_t* string,
                            uint8_t xPosition,
                            uint8_t yPosition,
                            OledRaystar_GrayScale grayscale)
{
    for (uint8_t i=0; string[i] != '\n' && string[i] != '\0'; i++)
    {
        OledRaystar_putChar(dev,string[i],(xPosition + 6*i),yPosition,grayscale);
    }
}

OledRaystar_Errors OledRaystar_drawRectangle (OledRaystar_Device* dev,
                                              uint8_t xPositionStart,
                                              uint8_t xPositionStop,
                                              uint8_t yPositionStart,
                                              uint8_t yPositionStop,
                                              OledRaystar_GrayScale color)
{
    if ((xPositionStart > dev->columns) || (xPositionStop > dev->columns))
        return OLEDRAYSTAR_ERRORS_WRONG_VALUE;

    if ((yPositionStart > dev->rows) || (yPositionStop > dev->rows))
        return OLEDRAYSTAR_ERRORS_WRONG_VALUE;

    if ((xPositionStart > xPositionStop) || (yPositionStart > yPositionStop))
        return OLEDRAYSTAR_ERRORS_WRONG_VALUE;

    for (uint8_t y = yPositionStart; y < yPositionStop + 1; y++)
    {
        for (uint8_t x = xPositionStart; x < xPositionStop + 1; x++)
        {
            OledRaystar_setPixel(dev,x,y,color);
        }
    }
}

OledRaystar_Errors OledRaystar_drawPicture (OledRaystar_Device* dev,
                                            uint8_t xPosition,
                                            uint8_t yPosition,
                                            uint8_t xDimension,
                                            uint8_t yDimension,
                                            uint8_t* picture)
{
    if ((xPosition > dev->columns) || (yPosition > dev->rows))
        return OLEDRAYSTAR_ERRORS_WRONG_VALUE;

    // divide by-2, because the columns is connected in pairs
    xPosition >>= 1;

    for (uint8_t y = yPosition; y < (yPosition + yDimension); y++)
    {
        for (uint8_t x = xPosition; x < (xPosition + xDimension); x++)
        {
            dev->dump[x][y] = picture[xDimension*(y-yPosition)+(x-xPosition)];
        }
    }
}

void OledRaystar_flush (OledRaystar_Device* dev)
{
    for (uint8_t y = 0; y < (dev->rows); ++y)
    {
        for (uint8_t x = 0; x < (dev->columns >> 1); ++x)
        {
            if (dev->dump[x][y] != dev->dumpOld[x][y])
            {
                OledRaystar_setBufferPosition(dev,x,y);
                OledRaystar_sendData(dev,dev->dump[x][y],TRUE);
                dev->dumpOld[x][y] = dev->dump[x][y];
            }
        }
    }
}
